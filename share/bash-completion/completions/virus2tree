#!/usr/bin/env bash

# Bash completion for virus2tree commands.

_v2t_sra_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-i --input -o --outdir -c --chunk-size -w --sleep-secs -l --layout -d --debug -h --help"

  case "$prev" in
    -i|--input)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    -o|--outdir)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
    -l|--layout)
      COMPREPLY=( $(compgen -W "SINGLE PAIRED" -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_v2t_step1_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-i --input -g --outgroup --root_dir --temp_dir --out_dir --resume_download --og_min_fraction \
        -p --use_mat_peptides -q --use_mat_peptides_only -T --threads --debug -h --help"

  case "$prev" in
    -i|--input|-g|--outgroup)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    --root_dir|--temp_dir|--out_dir)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_v2t_step2_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-r --reads -t --read_type -map_op --minimap2_options -T --threads --temp_dir --root_dir \
        --out_dir --stats_file --dedup --dedup_l --downsample --coverage --genome_size \
        --num_bases --num_reads --debug -h --help"

  case "$prev" in
    -r|--reads|--stats_file)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    --temp_dir|--root_dir|--out_dir)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
    -t|--read_type)
      COMPREPLY=( $(compgen -W "single paired" -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

complete -o default -F _v2t_sra_complete v2t-sra download_sra_reads.sh
complete -o default -F _v2t_step1_complete v2t-step1 virus2tree_step1.sh
complete -o default -F _v2t_step2_complete v2t-step2 virus2tree_step2.sh
